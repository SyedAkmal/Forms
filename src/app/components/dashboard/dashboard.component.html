<div class="dashboard-container">
  <!-- Top toolbar -->
  <mat-toolbar color="primary" class="toolbar">
    <span class="title">Dashboard</span>
    <span class="spacer"></span>
    <div class="action-bar">
     <button
  class="avatar-btn"
  mat-icon-button
  [matMenuTriggerFor]="userMenu"
  [matMenuTriggerRestoreFocus]="false"
  
 
  aria-label="User menu">
  <mat-icon>account_circle</mat-icon>
</button>


      <mat-menu #userMenu="matMenu">
        <button mat-menu-item disabled>
          <mat-icon>person</mat-icon>
          <span>{{ user?.displayName || user?.email || 'Signed in' }}</span>
        </button>
        <mat-divider></mat-divider>
  <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
   </mat-menu>

      <mat-form-field appearance="outline" class="plants pill">
        <mat-label>Select Plants</mat-label>
        <mat-select [(value)]="selectedPlants" multiple>
          <mat-option *ngFor="let p of (plants$ | async)" [value]="p.regoName">
            {{ p.plantName || p.regoName }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-flat-button class="btn-gradient" (click)="openAddPlantDialog($event)">
        <mat-icon>add</mat-icon>&nbsp;Add New Plant
      </button>

      <button mat-flat-button class="btn-ghost-warn" (click)="openAddUserDialog($event)">
        <mat-icon>person_add</mat-icon>&nbsp;Add New User
      </button>
    </div>
  </mat-toolbar>

  <!-- Body: sidebar + content -->
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo">Avante Forms</div>

      <!-- âœ… Restricted Templates button -->
      <button
        mat-button
        class="menu-button"
        routerLink="/template"
        *ngIf="authService.hasPermission(Permission.TEMPLATES_VIEW)">
        <mat-icon>table_view</mat-icon>
        Templates
      </button>

      <button mat-button class="menu-button" routerLink="/forms">
        <mat-icon>description</mat-icon>
        Forms
      </button>

      <button mat-button class="menu-button" routerLink="/problem-tracker">
        <mat-icon>bug_report</mat-icon>
        Problem Tracker
      </button>
    </div>

    <!-- Main content -->
    <div class="main-content">
      <!-- Welcome banner -->
      <div class="welcome-card">
        <mat-icon class="welcome-icon">campaign</mat-icon>
        <span>{{ welcomeMessages[branch] }}</span>
      </div>

      <!-- Templates panel -->
      <mat-card class="templates-card">
        <div class="section-header">
          <span class="title">Templates</span>
          <span class="spacer"></span>

          <mat-form-field appearance="fill" class="search-box">
            <mat-label>Search templates</mat-label>
            <input matInput (keyup)="applyFilter($event)" />
            <button mat-icon-button matSuffix *ngIf="searchValue" (click)="clearSearch()">
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>

          <button mat-icon-button (click)="createTemplate()" aria-label="Add template">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <div class="table-wrap" *ngIf="dataSource?.data?.length; else noTemplates">
          <table mat-table [dataSource]="dataSource" class="mat-elevation-z1">
            <!-- table defs unchanged -->
          </table>
        </div>

        <ng-template #noTemplates>
          <div class="empty-tip">No templates yet. Click <strong>+</strong> to create one.</div>
        </ng-template>
      </mat-card>

      <!-- Forms / Filled Forms panel -->
      <mat-card class="forms-card" style="margin-top:16px;">
        <!-- unchanged -->
      </mat-card>
    </div>
  </div>
</div>