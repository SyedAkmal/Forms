<div class="form-builder">
  <div class="top-section">
    <h2>Form Builder</h2>
    <div class="top-actions">
      <button mat-raised-button color="primary" (click)="backToDashboard()">Back to Dashboard</button>
      <button mat-raised-button color="primary" (click)="saveForm()">Save Form</button>
      <button mat-raised-button color="primary" (click)="exportToPDF()">Save as PDF</button>
    </div>
  </div>
  <div class="main-content">
    <div class="field-palette">
      <h3>Field Palette</h3>
      <div class="draggable-field" *ngFor="let field of paletteFields" draggable="true"
        (dragstart)="onDragStart(field.type)">{{ field.label }}</div>
    </div>

    <div class="form-canvas" (dragover)="allowDrop($event)" (drop)="dropField($event)">
      <ng-container *ngFor="let page of formPages || []; let pi = index">
        <div class="form-page" *ngIf="currentPage === pi">
          <div class="form-grid">
            <div *ngFor="let field of page.fields" class="form-field form-grid-item" [ngClass]="field.width"
              draggable="true" (dragstart)="onFieldDragStart(field, pi)">

              <!-- <mat-form-field *ngIf="field.type!=='branch' && field.type!=='textarea'" appearance="outline">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput [type]="field.type" [placeholder]="field.placeholder || ''">
                <mat-icon (click)="removeField(pi, field)" matSuffix>sentiment_very_satisfied</mat-icon>
              </mat-form-field> -->
              <label>{{ field.label }}</label>
              <input *ngIf="field.type!=='textarea' && field.type!=='branch'" [type]="field.type"
                [placeholder]="field.placeholder || ''" />
              <select *ngIf="field.type==='branch'" [ngModel]="field.options" (ngModelChange)="field.options = $event">
                <option *ngFor="let option of field.options || []" [value]="option.value">{{ option.label }}</option>
              </select>
              <textarea *ngIf="field.type==='textarea'" [placeholder]="field.placeholder || ''"></textarea>
              <button type="button" (click)="removeField(pi, field)">X</button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- <div class="actions">
    <button (click)="generateJSON()">Generate JSON</button>
    <button mat-raised-button color="primary" (click)="saveForm()">Save Form</button>
    <button (click)="loadForm()">Load Saved</button>
    <button mat-raised-button color="primary" (click)="exportToPDF()">Save as PDF</button>
  </div> -->

  <!-- <div class="pagination">
    <span>Page {{ currentPage + 1 }} of {{ formPages.length }}</span>
    <button (click)="prevPage()">Previous</button>
    <button (click)="nextPage()">Next</button>
  </div> -->
</div>

<div *ngIf="fieldConfigVisible" class="popup-overlay">
  <div class="popup">
    <h3>Configure Field</h3>
    <form (ngSubmit)="createField()">
      <input type="text" [(ngModel)]="newField.label" name="label" placeholder="Label" required>
      <!-- <select [(ngModel)]="newField.type" name="type" required>
        <option *ngFor="let type of inputTypes" [value]="type">{{ type }}</option>
      </select> -->
      <input type="text" [(ngModel)]="newField.placeholder" name="placeholder" placeholder="Placeholder">
      <select [(ngModel)]="newField.width" name="width">
        <option value="small">Small</option>
        <option value="medium">Medium Width</option>
        <option value="full">Full Width</option>
      </select>
      <button type="submit">Create</button>
      <button type="button" (click)="cancelFieldConfig()">Cancel</button>
    </form>
  </div>
</div>